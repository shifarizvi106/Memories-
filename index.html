<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Memory Lane ‚Äî Our Digital Scrapbook</title>
<style>
:root{
  --bg: #0f0f1a;
  --card: #1a1a2e;
  --text: #e2e8f0;
  --muted: #94a3b8;
  --accent: #8B5CF6;
  --accent-light: #4c1d95;
  --radius: 16px;
  --shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
  --scrap-pattern: repeating-linear-gradient(
    45deg,
    transparent,
    transparent 10px,
    rgba(139, 92, 246, 0.05) 10px,
    rgba(139, 92, 246, 0.05) 20px
  );
}
* {
  box-sizing: border-box;
}
body {
  margin: 0;
  font-family: 'Segoe UI', system-ui, sans-serif;
  background: var(--bg);
  background-image: 
    radial-gradient(circle at 25% 25%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 75% 75%, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
    var(--scrap-pattern);
  color: var(--text);
  line-height: 1.6;
  min-height: 100vh;
}

.container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 20px;
}
header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 30px;
  padding: 20px;
  background: var(--card);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  border: 1px solid rgba(139, 92, 246, 0.2);
  backdrop-filter: blur(10px);
}

.logo {
  font-weight: 800;
  font-size: 28px;
  color: var(--accent);
  display: flex;
  align-items: center;
  gap: 12px;
}
.logo .mark {
  width: 50px;
  height: 50px;
  border-radius: 12px;
  background: linear-gradient(135deg, var(--accent), #7c3aed);
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  font-weight: 800;
  font-size: 20px;
  box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
}

/* Scrapbook Layout */
.scrapbook-layout {
  display: grid;
  grid-template-columns: 280px 1fr;
  gap: 30px;
  min-height: 80vh;
}

/* Friends Sidebar - Sticky Scrapbook Feel */
.friends-scrapbook {
  background: var(--card);
  border-radius: var(--radius);
  padding: 25px;
  box-shadow: var(--shadow);
  border: 1px solid rgba(139, 92, 246, 0.2);
  position: sticky;
  top: 20px;
  height: fit-content;
  backdrop-filter: blur(10px);
}

.friend-scrap-item {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 15px;
  margin-bottom: 12px;
  background: rgba(30, 41, 59, 0.6);
  border-radius: 12px;
  border: 1px solid rgba(139, 92, 246, 0.2);
  cursor: pointer;
  transition: all 0.3s ease;
}
.friend-scrap-item:hover {
  transform: translateX(8px);
  background: rgba(139, 92, 246, 0.15);
  border-color: var(--accent);
  box-shadow: 0 4px 20px rgba(139, 92, 246, 0.2);
}
.friend-scrap-item.active {
  background: linear-gradient(135deg, var(--accent), #7c3aed);
  color: white;
  border-color: var(--accent);
  box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4);
}

.avatar-scrap {
  width: 50px;
  height: 50px;
  border-radius: 12px;
  background: linear-gradient(135deg, var(--accent), #EC4899);
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  font-weight: 800;
  font-size: 18px;
  border: 2px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
}

/* Main Scrapbook Area */
.scrapbook-main {
  background: var(--card);
  border-radius: var(--radius);
  padding: 30px;
  box-shadow: var(--shadow);
  border: 1px solid rgba(139, 92, 246, 0.2);
  min-height: 600px;
  backdrop-filter: blur(10px);
}

/* Profile Header - Scrapbook Style */
.profile-scrap-header {
  display: flex;
  gap: 25px;
  align-items: center;
  margin-bottom: 30px;
  padding-bottom: 25px;
  border-bottom: 2px solid rgba(139, 92, 246, 0.3);
}

.profile-scrap-avatar {
  width: 120px;
  height: 120px;
  border-radius: 20px;
  background: linear-gradient(135deg, var(--accent), #EC4899);
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  font-weight: 900;
  font-size: 42px;
  border: 4px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
}

.profile-scrap-info h1 {
  margin: 0;
  font-size: 32px;
  color: var(--accent);
  text-shadow: 0 2px 10px rgba(139, 92, 246, 0.3);
}
.profile-scrap-bio {
  font-size: 18px;
  color: var(--muted);
  margin: 10px 0;
  font-style: italic;
}
.profile-scrap-meta {
  display: flex;
  gap: 20px;
  margin-top: 15px;
}
.meta-badge {
  background: rgba(139, 92, 246, 0.15);
  padding: 8px 16px;
  border-radius: 20px;
  font-size: 14px;
  color: var(--accent);
  font-weight: 600;
  border: 1px solid rgba(139, 92, 246, 0.3);
}

/* Posts Grid - Polaroid Style */
.scrapbook-posts {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 25px;
  margin-top: 30px;
}

.post-polaroid {
  background: rgba(30, 41, 59, 0.8);
  padding: 20px 20px 30px;
  border-radius: 8px;
  box-shadow: 0 6px 25px rgba(0, 0, 0, 0.3);
  border: 1px solid rgba(139, 92, 246, 0.3);
  transition: all 0.3s ease;
  position: relative;
  transform: rotate(-1deg);
  backdrop-filter: blur(10px);
}
.post-polaroid:nth-child(even) {
  transform: rotate(1deg);
}
.post-polaroid:hover {
  transform: rotate(0deg) scale(1.05);
  box-shadow: 0 10px 35px rgba(139, 92, 246, 0.4);
  border-color: var(--accent);
}

.polaroid-image {
  width: 100%;
  height: 200px;
  object-fit: cover;
  border-radius: 4px;
  margin-bottom: 15px;
  border: 2px solid rgba(139, 92, 246, 0.2);
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}
.polaroid-caption {
  font-size: 14px;
  color: var(--text);
  margin-bottom: 10px;
  padding: 0 5px;
}
.polaroid-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 12px;
  color: var(--muted);
  border-top: 1px solid rgba(139, 92, 246, 0.2);
  padding-top: 10px;
}

/* Login Screen - Scrapbook Theme */
.login-scrapbook {
  max-width: 500px;
  margin: 60px auto;
  padding: 40px;
  background: var(--card);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  border: 1px solid rgba(139, 92, 246, 0.3);
  text-align: center;
  backdrop-filter: blur(10px);
}

.login-scrapbook h2 {
  color: var(--accent);
  margin-bottom: 10px;
  font-size: 32px;
  text-shadow: 0 2px 10px rgba(139, 92, 246, 0.3);
}
.login-scrapbook .subtitle {
  color: var(--muted);
  margin-bottom: 30px;
  font-size: 18px;
}

.scrap-input {
  width: 100%;
  padding: 18px;
  border: 1px solid rgba(139, 92, 246, 0.3);
  border-radius: 12px;
  font-size: 16px;
  margin-bottom: 20px;
  background: rgba(30, 41, 59, 0.6);
  color: var(--text);
  transition: all 0.3s ease;
}
.scrap-input:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
  background: rgba(30, 41, 59, 0.8);
}

.scrap-btn {
  width: 100%;
  padding: 18px;
  background: linear-gradient(135deg, var(--accent), #7c3aed);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 18px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-bottom: 15px;
  box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
}
.scrap-btn:hover {
  background: linear-gradient(135deg, #7c3aed, var(--accent));
  transform: translateY(-2px);
  box-shadow: 0 6px 25px rgba(139, 92, 246, 0.4);
}

/* Empty State */
.empty-scrapbook {
  text-align: center;
  padding: 80px 20px;
  color: var(--muted);
}
.empty-scrapbook h3 {
  font-size: 24px;
  margin-bottom: 10px;
  color: var(--accent);
}
.empty-scrapbook p {
  font-size: 16px;
}

/* Action Buttons */
.scrap-actions {
  display: flex;
  gap: 15px;
  margin: 25px 0;
}
.action-btn {
  padding: 12px 24px;
  border: 1px solid rgba(139, 92, 246, 0.3);
  background: rgba(30, 41, 59, 0.6);
  border-radius: 10px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
  color: var(--text);
}
.action-btn.primary {
  background: linear-gradient(135deg, var(--accent), #7c3aed);
  color: white;
  border-color: var(--accent);
}
.action-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
  border-color: var(--accent);
}

/* Multiple Upload Styles */
.multiple-upload-btn {
  background: linear-gradient(135deg, #10b981, #059669) !important;
}
.multiple-upload-btn:hover {
  background: linear-gradient(135deg, #059669, #10b981) !important;
}

.upload-progress {
  margin: 10px 0;
  padding: 10px;
  background: rgba(139, 92, 246, 0.1);
  border-radius: 8px;
  border: 1px solid rgba(139, 92, 246, 0.3);
}
.progress-text {
  font-size: 14px;
  color: var(--muted);
  text-align: center;
}

/* Modal Styles */
.modal-backdrop {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  backdrop-filter: blur(5px);
}

.modal-content {
  background: var(--card);
  padding: 30px;
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  border: 1px solid rgba(139, 92, 246, 0.3);
  max-width: 500px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
}

.modal-title {
  color: var(--accent);
  margin-bottom: 20px;
  text-align: center;
}

/* Responsive */
@media (max-width: 768px) {
  .scrapbook-layout {
    grid-template-columns: 1fr;
  }
  .friends-scrapbook {
    position: static;
    margin-bottom: 20px;
  }
  .profile-scrap-header {
    flex-direction: column;
    text-align: center;
  }
  .profile-scrap-meta {
    justify-content: center;
  }
}

/* Scrollbar Styling */
::-webkit-scrollbar {
  width: 8px;
}
::-webkit-scrollbar-track {
  background: rgba(30, 41, 59, 0.3);
}
::-webkit-scrollbar-thumb {
  background: var(--accent);
  border-radius: 4px;
}
::-webkit-scrollbar-thumb:hover {
  background: #7c3aed;
}
</style>
</head>
<body>
<div class="container">
  <header>
    <div class="logo">
      <div class="mark">ML</div>
      <div>Memory Lane Scrapbook</div>
    </div>
    <div id="authArea"></div>
  </header>

  <!-- LOGIN SCREEN -->
  <div id="loginScreen">
    <div class="login-scrapbook">
      <h2>Welcome to Our Scrapbook! üìñ</h2>
      <p class="subtitle">A private digital memory book for our group</p>
      
      <input type="text" id="loginName" class="scrap-input" placeholder="Your Name (e.g., Ritika)">
      <input type="text" id="loginPassword" class="scrap-input" placeholder="Birthday (DD-MM-YY e.g., 10-06-08)">
      
      <button class="scrap-btn" id="doLogin">Open Our Scrapbook</button>
      
      <p id="loginError" style="color:#f87171; margin-top:15px"></p>
    </div>
  </div>

  <!-- MAIN APP -->
  <div id="app" style="display:none">
    <div class="scrapbook-layout">
      <!-- Friends Sidebar -->
      <aside class="friends-scrapbook">
        <h3 style="margin:0 0 20px; color:var(--accent)">Our Memory Keepers ‚ú®</h3>
        <div id="friendsList"></div>
        
        <div style="margin-top:30px; padding-top:20px; border-top:1px solid rgba(139, 92, 246, 0.3)">
          <h4 style="margin:0 0 15px; color:var(--accent)">üéÇ Coming Up</h4>
          <div id="upcomingList"></div>
        </div>
      </aside>

      <!-- Main Scrapbook Content -->
      <main class="scrapbook-main">
        <div class="profile-scrap-header">
          <div class="profile-scrap-avatar" id="profileAvatar"></div>
          <div class="profile-scrap-info">
            <h1 id="profileName"></h1>
            <p class="profile-scrap-bio" id="profileBio"></p>
            <div class="profile-scrap-meta">
              <div class="meta-badge">üéÇ <span id="profileBday"></span></div>
              <div class="meta-badge">üì∏ <span id="postCount">0</span> memories</div>
            </div>
          </div>
        </div>

        <!-- Action Buttons (only show when viewing own profile) -->
        <div class="scrap-actions" id="actionButtons" style="display:none">
          <button class="action-btn primary" id="newMemoryBtn">+ Add Single Memory</button>
          <button class="action-btn primary multiple-upload-btn" id="multiMemoryBtn">+ Add Multiple Memories</button>
          <button class="action-btn" id="editProfileBtn">Edit Profile</button>
          <button class="action-btn" id="logoutBtn" style="margin-left:auto">Logout</button>
        </div>

        <!-- Memories Grid -->
        <div id="postsArea">
          <div class="scrapbook-posts" id="postsGrid"></div>
          <div class="empty-scrapbook" id="noPostsNotice">
            <h3>No memories yet üåô</h3>
            <p>This scrapbook page is waiting for its first memory...</p>
          </div>
        </div>
      </main>
    </div>
  </div>
</div>

<script>
// Our friend group data - NOW WITH PALAK!
const FRIENDS = [
  { name: "Ritika", birthday: "06-07-08", bio: "sab" },
  { name: "Vidhi", birthday: "12-11-08", bio: "apna" },
  { name: "Saksham", birthday: "24-01-09", bio: "bio" },
  { name: "Harshit", birthday: "23-01-07", bio: "khudh" },
  { name: "Sai", birthday: "04-03-08", bio: "se" },
  { name: "Juili", birthday: "25-05-08", bio: "daal lo" },
  { name: "Kunal", birthday: "19-10-08", bio: "pfp" },
  { name: "Ayaan", birthday: "16-01-08", bio: "and all" },
  { name: "Amrut", birthday: "20-09-05", bio: "bhi" },
  { name: "Shifa", birthday: "10-06-08", bio: "PThe Best" },
  { name: "Palak", birthday: "06-11-08", bio: "Ligma" }
];

// App state
let currentUser = null;
let viewingProfile = null;

// DOM elements
const loginScreen = document.getElementById('loginScreen');
const app = document.getElementById('app');
const friendsList = document.getElementById('friendsList');
const upcomingList = document.getElementById('upcomingList');
const profileAvatar = document.getElementById('profileAvatar');
const profileName = document.getElementById('profileName');
const profileBio = document.getElementById('profileBio');
const profileBday = document.getElementById('profileBday');
const postCount = document.getElementById('postCount');
const postsGrid = document.getElementById('postsGrid');
const noPostsNotice = document.getElementById('noPostsNotice');
const actionButtons = document.getElementById('actionButtons');
const authArea = document.getElementById('authArea');

// Storage helpers
function getPostsKey(username) { return `ml_posts_${username.toLowerCase()}`; }
function getAvatarKey(username) { return `ml_avatar_${username.toLowerCase()}`; }
function getProfileKey(username) { return `ml_profile_${username.toLowerCase()}`; }

function loadPosts(username) {
  try { return JSON.parse(localStorage.getItem(getPostsKey(username))) || []; } 
  catch { return []; }
}

function savePosts(username, posts) {
  localStorage.setItem(getPostsKey(username), JSON.stringify(posts));
}

function loadAvatar(username) {
  return localStorage.getItem(getAvatarKey(username));
}

function saveAvatar(username, dataURL) {
  localStorage.setItem(getAvatarKey(username), dataURL);
}

function loadProfile(username) {
  try { 
    const profile = localStorage.getItem(getProfileKey(username));
    return profile ? JSON.parse(profile) : { bio: FRIENDS.find(f => f.name === username)?.bio || '' };
  } catch { 
    return { bio: FRIENDS.find(f => f.name === username)?.bio || '' };
  }
}

function saveProfile(username, profileData) {
  localStorage.setItem(getProfileKey(username), JSON.stringify(profileData));
}

// Login function
function handleLogin() {
  const name = document.getElementById('loginName').value.trim();
  const password = document.getElementById('loginPassword').value.trim();
  const error = document.getElementById('loginError');

  if (!name || !password) {
    error.textContent = 'Please enter both name and birthday';
    return;
  }

  const user = FRIENDS.find(f => 
    f.name.toLowerCase() === name.toLowerCase() && 
    f.birthday === password
  );

  if (user) {
    currentUser = user;
    viewingProfile = user.name;
    showApp();
  } else {
    error.textContent = 'Name or birthday not recognized';
  }
}

// Show main app
function showApp() {
  loginScreen.style.display = 'none';
  app.style.display = 'block';
  renderFriendsList();
  renderUpcomingBirthdays();
  renderProfile(viewingProfile);
  renderAuthArea();
}

// Render friends list
function renderFriendsList() {
  friendsList.innerHTML = '';
  FRIENDS.forEach(friend => {
    const isActive = friend.name === viewingProfile;
    const isCurrentUser = friend.name === currentUser.name;
    
    const friendEl = document.createElement('div');
    friendEl.className = `friend-scrap-item ${isActive ? 'active' : ''}`;
    friendEl.onclick = () => {
      viewingProfile = friend.name;
      renderProfile(friend.name);
      renderFriendsList();
    };

    const avatar = document.createElement('div');
    avatar.className = 'avatar-scrap';
    const savedAvatar = loadAvatar(friend.name);
    if (savedAvatar) {
      avatar.style.backgroundImage = `url(${savedAvatar})`;
      avatar.style.backgroundSize = 'cover';
      avatar.textContent = '';
    } else {
      avatar.textContent = friend.name[0];
    }

    const savedProfile = loadProfile(friend.name);
    const displayBio = savedProfile.bio || friend.bio;

    const info = document.createElement('div');
    info.innerHTML = `
      <div style="font-weight:700">${friend.name} ${isCurrentUser ? ' (You)' : ''}</div>
      <div style="font-size:12px;color:${isActive ? 'white' : 'var(--muted)'}">${displayBio}</div>
    `;

    friendEl.appendChild(avatar);
    friendEl.appendChild(info);
    friendsList.appendChild(friendEl);
  });
}

// Render upcoming birthdays
function renderUpcomingBirthdays() {
  upcomingList.innerHTML = '';
  const today = new Date();
  
  FRIENDS.forEach(friend => {
    const [day, month, year] = friend.birthday.split('-');
    const nextBirthday = new Date(today.getFullYear(), parseInt(month) - 1, parseInt(day));
    if (nextBirthday < today) nextBirthday.setFullYear(nextBirthday.getFullYear() + 1);
    
    const daysUntil = Math.ceil((nextBirthday - today) / (1000 * 60 * 60 * 24));
    
    if (daysUntil <= 30) {
      const item = document.createElement('div');
      item.style.marginBottom = '8px';
      item.innerHTML = `
        <strong>${friend.name}</strong> 
        <span style="color:var(--muted);font-size:12px">- ${daysUntil} day${daysUntil !== 1 ? 's' : ''}</span>
      `;
      upcomingList.appendChild(item);
    }
  });
}

// Render profile - FIXED: Now properly uses saved profiles
function renderProfile(username) {
  const friend = FRIENDS.find(f => f.name === username);
  if (!friend) return;

  const savedProfile = loadProfile(username);
  const savedAvatar = loadAvatar(username);

  // Update profile header
  profileName.textContent = friend.name;
  profileBio.textContent = savedProfile.bio || friend.bio;
  profileBday.textContent = formatBirthday(friend.birthday);

  // Update avatar
  if (savedAvatar) {
    profileAvatar.style.backgroundImage = `url(${savedAvatar})`;
    profileAvatar.style.backgroundSize = 'cover';
    profileAvatar.textContent = '';
  } else {
    profileAvatar.style.backgroundImage = '';
    profileAvatar.textContent = friend.name[0];
  }

  // Show/hide action buttons
  const isOwnProfile = friend.name === currentUser.name;
  actionButtons.style.display = isOwnProfile ? 'flex' : 'none';

  // Render posts
  renderPosts(username);
}

// Format birthday display
function formatBirthday(bday) {
  const [d, m, y] = bday.split('-');
  const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
  return `${parseInt(d)} ${months[parseInt(m) - 1]} 20${y}`;
}

// Render posts
function renderPosts(username) {
  const posts = loadPosts(username);
  postsGrid.innerHTML = '';
  
  postCount.textContent = posts.length;
  
  if (posts.length === 0) {
    noPostsNotice.style.display = 'block';
    return;
  }
  
  noPostsNotice.style.display = 'none';
  
  posts.forEach(post => {
    const postEl = document.createElement('div');
    postEl.className = 'post-polaroid';
    postEl.innerHTML = `
      <img src="${post.image}" class="polaroid-image" alt="Memory">
      <div class="polaroid-caption">${post.caption || 'A beautiful memory üí´'}</div>
      <div class="polaroid-meta">
        <span>${new Date(post.createdAt).toLocaleDateString()}</span>
        ${username === currentUser.name ? '<button onclick="deletePost(\'' + post.id + '\')" style="background:none;border:none;cursor:pointer;color:var(--muted)">üóëÔ∏è</button>' : ''}
      </div>
    `;
    postsGrid.appendChild(postEl);
  });
}

// Add single memory
document.getElementById('newMemoryBtn').onclick = function() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'image/*';
  input.onchange = function(e) {
    const file = e.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
      const caption = prompt('Add a caption for this memory:') || 'A special moment üí´';
      const posts = loadPosts(currentUser.name);
      const newPost = {
        id: Date.now().toString(),
        image: e.target.result,
        caption: caption,
        createdAt: Date.now()
      };
      
      posts.unshift(newPost);
      savePosts(currentUser.name, posts);
      renderPosts(currentUser.name);
    };
    reader.readAsDataURL(file);
  };
  input.click();
};

// NEW: Add multiple memories at once
document.getElementById('multiMemoryBtn').onclick = function() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'image/*';
  input.multiple = true;
  input.onchange = async function(e) {
    const files = Array.from(e.target.files);
    if (files.length === 0) return;

    // Create modal for progress
    const modal = document.createElement('div');
    modal.className = 'modal-backdrop';
    modal.innerHTML = `
      <div class="modal-content">
        <h3 class="modal-title">Uploading ${files.length} Memories...</h3>
        <div class="upload-progress">
          <div class="progress-text" id="progressText">Preparing upload...</div>
        </div>
        <div style="display:flex;gap:10px;justify-content:center;margin-top:20px">
          <button class="action-btn" id="cancelUpload">Cancel</button>
        </div>
      </div>
    `;
    document.body.appendChild(modal);

    let uploadCancelled = false;
    modal.querySelector('#cancelUpload').onclick = () => {
      uploadCancelled = true;
      modal.remove();
    };

    const posts = loadPosts(currentUser.name);
    let uploadedCount = 0;

    for (const file of files) {
      if (uploadCancelled) break;

      const progressText = modal.querySelector('#progressText');
      progressText.textContent = `Uploading ${uploadedCount + 1} of ${files.length}: ${file.name}`;

      try {
        const imageData = await readFileAsDataURL(file);
        const caption = `Memory ${uploadedCount + 1} from batch upload üì∏`;
        
        const newPost = {
          id: Date.now().toString() + uploadedCount,
          image: imageData,
          caption: caption,
          createdAt: Date.now()
        };
        
        posts.unshift(newPost);
        uploadedCount++;
        
      } catch (error) {
        console.error('Error uploading file:', file.name, error);
      }
    }

    if (!uploadCancelled) {
      savePosts(currentUser.name, posts);
      renderPosts(currentUser.name);
      modal.querySelector('#progressText').textContent = `Successfully uploaded ${uploadedCount} memories! üéâ`;
      setTimeout(() => modal.remove(), 2000);
    }
  };
  input.click();
};

// Helper function for file reading
function readFileAsDataURL(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = e => resolve(e.target.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

// Delete post
function deletePost(postId) {
  if (!confirm('Remove this memory from your scrapbook?')) return;
  
  const posts = loadPosts(currentUser.name).filter(p => p.id !== postId);
  savePosts(currentUser.name, posts);
  renderPosts(currentUser.name);
}

// Edit profile - FIXED: Now works properly
document.getElementById('editProfileBtn').onclick = function() {
  const savedProfile = loadProfile(currentUser.name);
  const currentBio = savedProfile.bio || FRIENDS.find(f => f.name === currentUser.name)?.bio || '';
  
  const newBio = prompt('Update your bio:', currentBio);
  
  if (newBio !== null) {
    // Save the new bio
    saveProfile(currentUser.name, { bio: newBio });
    // Update the display
    profileBio.textContent = newBio;
    // Update friends list
    renderFriendsList();
  }
  
  // Avatar upload
  const avatarInput = document.createElement('input');
  avatarInput.type = 'file';
  avatarInput.accept = 'image/*';
  avatarInput.onchange = function(e) {
    const file = e.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
      saveAvatar(currentUser.name, e.target.result);
      renderProfile(currentUser.name);
      renderFriendsList();
    };
    reader.readAsDataURL(file);
  };
  avatarInput.click();
};

// Render auth area
function renderAuthArea() {
  authArea.innerHTML = `
    <div style="display:flex;align-items:center;gap:15px">
      <div style="color:var(--muted)">Hello, <strong style="color:var(--accent)">${currentUser.name}</strong>! ‚ú®</div>
    </div>
  `;
}

// Logout
document.getElementById('logoutBtn').onclick = function() {
  if (confirm('Close the scrapbook for now?')) {
    currentUser = null;
    viewingProfile = null;
    app.style.display = 'none';
    loginScreen.style.display = 'block';
    document.getElementById('loginName').value = '';
    document.getElementById('loginPassword').value = '';
  }
};

// Event listeners
document.getElementById('doLogin').addEventListener('click', handleLogin);

// Allow Enter key to login
document.addEventListener('keypress', function(e) {
  if (e.key === 'Enter' && loginScreen.style.display !== 'none') {
    handleLogin();
  }
});
</script>
</body>
</html>
