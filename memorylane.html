<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Memory Lane â€” Profiles</title>
<style>
:root{
  --bg:#ffffff; --card:#fff; --text:#0f1724; --muted:#64748b;
  --accent: linear-gradient(135deg,#8B5CF6,#EC4899);
  --radius:12px; --shadow: 0 10px 25px rgba(2,6,23,0.06);
}
.dark{--bg:#0b1220; --card:#0f1724; --text:#e6eef8; --muted:#9fb0c8; --shadow:0 10px 25px rgba(2,6,23,0.6);}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
.container{max-width:1200px;margin:0 auto;padding:20px}
header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
.logo{font-weight:800;letter-spacing:-0.2px;display:flex;gap:10px;align-items:center}
.logo .mark{width:44px;height:44px;border-radius:10px;background:var(--accent);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800}
.header-actions{display:flex;gap:12px;align-items:center}
.toggle{width:48px;height:28px;border-radius:20px;background:#dbeafe;position:relative;cursor:pointer}
.toggle .dot{width:20px;height:20px;border-radius:50%;background:white;position:absolute;left:4px;top:4px;transition:all .22s}
.dark .toggle{background:#1f2a44}
.dark .toggle .dot{left:calc(100% - 24px)}
.grid{display:grid;grid-template-columns:300px 1fr;gap:24px}
.sidebar{background:var(--card);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow)}
.section-title{font-weight:700;color:var(--muted);margin-bottom:8px;display:flex;justify-content:space-between;align-items:center}
.friends-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px}
.friend-card{display:flex;gap:10px;align-items:center;padding:8px;border-radius:10px;cursor:pointer;border:1px solid rgba(15,23,36,0.04);transition:all .15s}
.friend-card:hover{transform:translateY(-4px)}
.avatar{width:46px;height:46px;border-radius:10px;background:linear-gradient(135deg,#8B5CF6,#EC4899);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:18px;overflow:hidden}
.friend-meta{font-size:13px}
.friend-name{font-weight:700}
.friend-bday{color:var(--muted);font-size:12px;margin-top:3px}

/* main area */
.main-card{background:var(--card);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow)}
.profile-header{display:flex;gap:18px;align-items:center;margin-bottom:18px}
.profile-avatar{width:96px;height:96px;border-radius:16px;background:linear-gradient(135deg,#8B5CF6,#EC4899);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:900;font-size:34px;overflow:hidden}
.profile-info h2{margin:0;font-size:20px}
.profile-info p{margin:6px 0;color:var(--muted);font-size:14px}
.profile-actions{margin-left:auto;display:flex;gap:8px;align-items:center}

/* posts grid */
.toolbar{display:flex;gap:8px;align-items:center;margin-bottom:12px}
.btn{padding:9px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
.btn-primary{background:linear-gradient(135deg,#8B5CF6,#EC4899);color:#fff}
.btn-ghost{background:transparent;border:1px solid rgba(15,23,36,0.06)}
.posts-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px}
.post{background:var(--card);border-radius:12px;overflow:hidden;border:1px solid rgba(15,23,36,0.04);display:flex;flex-direction:column}
.post-img{width:100%;height:180px;object-fit:cover;background:#f3f4f6}
.post-body{padding:10px;display:flex;flex-direction:column;gap:8px}
.caption{font-size:13px;color:var(--text)}
.post-meta{display:flex;justify-content:space-between;align-items:center}
.small-muted{font-size:12px;color:var(--muted)}
.icon-btn{background:transparent;border:none;cursor:pointer;font-size:16px}

/* upload modal */
.modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:flex;align-items:center;justify-content:center}
.modal{background:var(--card);padding:16px;border-radius:12px;width:380px;box-shadow:var(--shadow)}
.form-row{display:flex;flex-direction:column;gap:8px;margin-bottom:10px}
.input,textarea{padding:10px;border-radius:8px;border:1px solid rgba(15,23,36,0.06);font-size:14px}
textarea{min-height:90px;resize:vertical}
.small{font-size:12px;color:var(--muted)}
.logout{background:transparent;border:1px solid rgba(15,23,36,0.06);padding:8px 10px;border-radius:8px;cursor:pointer}

/* responsive */
@media(max-width:880px){.grid{grid-template-columns:1fr}.friends-grid{grid-template-columns:repeat(3,1fr)}}
</style>
</head>
<body>
<div class="container">
  <header>
    <div class="logo">
      <div class="mark">ML</div>
      <div>
        <div style="font-size:16px;font-weight:800">Memory Lane</div>
        <div style="font-size:12px;color:var(--muted)">Your mini social, local & private</div>
      </div>
    </div>

    <div class="header-actions">
      <div id="authArea" style="display:flex;gap:8px;align-items:center">
        <!-- login/logout area injected -->
      </div>
      <div class="toggle" id="darkToggle" title="Toggle dark">
        <div class="dot"></div>
      </div>
    </div>
  </header>

  <!-- LOGIN screen (shown when not logged in) -->
  <div id="loginScreen">
    <div style="max-width:420px;margin:40px auto;padding:18px;border-radius:12px;background:var(--card);box-shadow:var(--shadow)">
      <h2 style="margin:6px 0 8px">Sign in</h2>
      <p class="small" style="margin:0 0 14px;color:var(--muted)">Log in with name (username) and birthday (YYYY-MM-DD) as password.</p>
      <div style="display:flex;flex-direction:column;gap:8px">
        <input id="loginName" class="input" placeholder="Name (e.g., Ritika)" />
        <input id="loginPassword" class="input" placeholder="Birthday (YYYY-MM-DD)" />
        <div style="display:flex;gap:8px;align-items:center">
          <button class="btn btn-primary" id="doLogin">Log in</button>
          <button class="btn btn-ghost" id="demoLogin">Quick demo (Shifa)</button>
        </div>
        <p id="loginError" class="small" style="color:#c62828"></p>
      </div>
    </div>
  </div>

  <!-- APP -->
  <div id="app" style="display:none">
    <div class="grid">
      <aside class="sidebar">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="section-title">Friends</div>
          <div style="font-size:12px;color:var(--muted)"><span id="loggedAs"></span></div>
        </div>

        <div class="friends-grid" id="friendsList"></div>

        <div style="height:14px"></div>
        <div>
          <div class="section-title">Upcoming Birthdays <span class="small" style="font-weight:400"></span></div>
          <div id="upcomingList" class="small" style="display:flex;flex-direction:column;gap:8px"></div>
        </div>
      </aside>

      <main>
        <div class="main-card">
          <div style="display:flex;align-items:center">
            <div class="profile-header">
              <div class="profile-avatar" id="profileAvatar"></div>
              <div class="profile-info">
                <h2 id="profileName"></h2>
                <p id="profileBio" class="small"></p>
                <p class="small" id="profileBday"></p>
              </div>
            </div>

            <div class="profile-actions" style="margin-left:auto">
              <button class="btn btn-ghost" id="editProfileBtn">Edit Profile</button>
              <button class="btn btn-ghost" id="logoutBtn">Logout</button>
            </div>
          </div>

          <div style="margin-top:12px" class="toolbar">
            <button class="btn btn-primary" id="newPostBtn">+ New Post</button>
            <div style="flex:1"></div>
            <div class="small-muted">Viewing: <span id="viewLabel"></span></div>
          </div>

          <div id="postsArea">
            <div class="posts-grid" id="postsGrid"></div>
            <div id="noPostsNotice" class="small muted" style="margin-top:12px"></div>
          </div>
        </div>
      </main>
    </div>
  </div>
</div>

<!-- Upload / Edit Modals (simple) -->
<div id="modalRoot"></div>

<script>
/* ---------- Data: friends list ---------- */
const FRIENDS = [
  { name:'Ritika', birthday:'2008-07-06', bio:'Loves chai & sketches' },
  { name:'Vidhi', birthday:'2008-11-12', bio:'Bookworm + vibes' },
  { name:'Saksham', birthday:'2009-01-24', bio:'Tech nerd & gamer' },
  { name:'Harshit', birthday:'2007-01-23', bio:'Cricket & coding' },
  { name:'Sai', birthday:'2008-03-04', bio:'Photography shy king' },
  { name:'Juili', birthday:'2008-05-25', bio:'Painter of tiny worlds' },
  { name:'Kunal', birthday:'2008-10-19', bio:'Sketches & snacks' },
  { name:'Ayaan', birthday:'2008-01-16', bio:'Puns + math' },
  { name:'Amrut', birthday:'2005-09-20', bio:'Old soul' },
  { name:'Shifa', birthday:'2008-06-10', bio:'Poet, baddie, album-maker' }
];

/* ---------- Persistence helpers ---------- */
const keyForPosts = username => 'ml_posts_' + username.toLowerCase();
const keyForAvatar = username => 'ml_avatar_' + username.toLowerCase();
const keyForProfile = username => 'ml_profile_' + username.toLowerCase(); // stores bio overrides

function loadPosts(username){
  try{
    const raw = localStorage.getItem(keyForPosts(username));
    if(!raw) return [];
    return JSON.parse(raw);
  }catch(e){ return [];}
}
function savePosts(username, posts){
  localStorage.setItem(keyForPosts(username), JSON.stringify(posts));
}
function loadAvatar(username){
  return localStorage.getItem(keyForAvatar(username)); // dataURL or null
}
function saveAvatar(username, dataURL){
  localStorage.setItem(keyForAvatar(username), dataURL);
}
function loadProfile(username){
  try{ const raw = localStorage.getItem(keyForProfile(username)); return raw ? JSON.parse(raw) : null; }catch(e){return null;}
}
function saveProfile(username, profileObj){
  localStorage.setItem(keyForProfile(username), JSON.stringify(profileObj));
}

/* ---------- App state ---------- */
let loggedIn = null; // object from FRIENDS when signed in
let currentView = null; // username string of profile being viewed

/* ---------- UI refs ---------- */
const loginScreen = document.getElementById('loginScreen');
const appRoot = document.getElementById('app');
const friendsListEl = document.getElementById('friendsList');
const upcomingListEl = document.getElementById('upcomingList');
const profileAvatarEl = document.getElementById('profileAvatar');
const profileNameEl = document.getElementById('profileName');
const profileBioEl = document.getElementById('profileBio');
const profileBdayEl = document.getElementById('profileBday');
const postsGrid = document.getElementById('postsGrid');
const viewLabel = document.getElementById('viewLabel');
const loggedAs = document.getElementById('loggedAs');
const modalRoot = document.getElementById('modalRoot');
const loginError = document.getElementById('loginError');
const noPostsNotice = document.getElementById('noPostsNotice');

/* ---------- Helpers ---------- */
function fmtDate(dateStr){
  const d = new Date(dateStr);
  if(isNaN(d)) return dateStr;
  return d.toLocaleDateString('en-GB',{day:'numeric',month:'short',year:'numeric'});
}
function fmtDateShort(dateStr){
  const d = new Date(dateStr);
  if(isNaN(d)) return dateStr;
  return d.toLocaleDateString('en-GB',{day:'numeric',month:'short'});
}

/* ---------- Auth flow ---------- */
document.getElementById('doLogin').addEventListener('click', doLogin);
document.getElementById('demoLogin').addEventListener('click', ()=>{ document.getElementById('loginName').value='Shifa'; document.getElementById('loginPassword').value='2008-06-10'; doLogin(); });

function doLogin(){
  loginError.textContent ='';
  const name = (document.getElementById('loginName').value || '').trim();
  const pass = (document.getElementById('loginPassword').value || '').trim();
  if(!name || !pass){ loginError.textContent='Please enter both name and birthday (YYYY-MM-DD)'; return; }
  const found = FRIENDS.find(f => f.name.toLowerCase() === name.toLowerCase() && f.birthday === pass);
  if(!found){ loginError.textContent='Invalid credentials â€” check spelling & format (YYYY-MM-DD)'; return; }
  loggedIn = found;
  currentView = found.name; // show own profile by default
  // show UI
  loginScreen.style.display = 'none';
  appRoot.style.display = 'block';
  renderAuthArea();
  renderFriendsList();
  renderUpcoming();
  renderProfile(currentView);
}

/* ---------- Render Auth area (logout/info) ---------- */
function renderAuthArea(){
  const authArea = document.getElementById('authArea');
  authArea.innerHTML = '';
  const who = document.createElement('div');
  who.style.fontSize='13px'; who.style.color='var(--muted)';
  who.textContent = 'Signed in as ' + loggedIn.name;
  loggedAs.textContent = 'you: ' + loggedIn.name;
  const logout = document.createElement('button');
  logout.className='logout';
  logout.textContent='Logout';
  logout.onclick = ()=>{ loggedIn = null; currentView=null; appRoot.style.display='none'; loginScreen.style.display='block'; document.getElementById('loginName').value=''; document.getElementById('loginPassword').value=''; };
  authArea.appendChild(who);
  authArea.appendChild(logout);
}

/* ---------- Friends sidebar ---------- */
function renderFriendsList(){
  friendsListEl.innerHTML='';
  FRIENDS.forEach((f,i)=>{
    const el = document.createElement('div');
    el.className='friend-card';
    el.title = 'Open profile';
    el.onclick = ()=>{ currentView = f.name; renderProfile(f.name); };

    const a = document.createElement('div'); a.className='avatar'; a.id = 'avatar_side_' + f.name;
    const saved = loadAvatar(f.name);
    if(saved){ a.style.backgroundImage = `url(${saved})`; a.textContent=''; a.style.backgroundSize='cover'; } else { a.textContent = f.name[0]; }

    const meta = document.createElement('div'); meta.className='friend-meta';
    const nm = document.createElement('div'); nm.className='friend-name'; nm.textContent = f.name + (f.name === loggedIn.name ? ' (you)' : '');
    const bd = document.createElement('div'); bd.className='friend-bday'; bd.textContent = fmtDateShort(f.birthday);
    meta.appendChild(nm); meta.appendChild(bd);

    el.appendChild(a); el.appendChild(meta);
    friendsListEl.appendChild(el);
  });
}

/* ---------- Upcoming birthdays (30 days) ---------- */
function renderUpcoming(){
  upcomingListEl.innerHTML='';
  const today = new Date();
  const upcoming = FRIENDS
    .map(f => {
      const b = new Date(f.birthday); b.setFullYear(today.getFullYear());
      const diff = Math.round((b - today) / (1000*60*60*24));
      return {...f, daysUntil: diff, nextB: b};
    })
    .filter(x => x.daysUntil >= 0 && x.daysUntil <= 30)
    .sort((a,b)=>a.daysUntil - b.daysUntil);

  if(upcoming.length===0){
    upcomingListEl.innerHTML = '<div style="color:var(--muted)">No birthdays in the next 30 days</div>';
    return;
  }
  upcoming.forEach(u=>{
    const el = document.createElement('div');
    el.innerHTML = `<strong>${u.name}</strong> â€” <span class="small">${fmtDateShort(u.birthday)} (${u.daysUntil}d)</span>`;
    upcomingListEl.appendChild(el);
  });
}

/* ---------- Profile view ---------- */
function renderProfile(username){
  const friend = FRIENDS.find(f=>f.name === username);
  if(!friend) return;
  // Profile header: avatar, name, bio, bday
  const savedProfile = loadProfile(friend.name) || {};
  profileNameEl.textContent = friend.name + (friend.name === loggedIn.name ? ' â€¢ you' : '');
  profileBioEl.textContent = savedProfile.bio || friend.bio || '';
  profileBdayEl.textContent = 'Birthday â€¢ ' + fmtDate(friend.birthday);
  // avatar
  const av = loadAvatar(friend.name);
  if(av){ profileAvatarEl.style.backgroundImage = `url(${av})`; profileAvatarEl.textContent=''; profileAvatarEl.style.backgroundSize='cover'; }
  else { profileAvatarEl.style.backgroundImage=''; profileAvatarEl.textContent = friend.name[0]; }

  // view label
  viewLabel.textContent = (friend.name === loggedIn.name) ? 'Your profile' : friend.name + "'s profile";

  // show/hide edit and new post actions based on ownership
  document.getElementById('editProfileBtn').style.display = (friend.name === loggedIn.name) ? 'inline-flex' : 'none';
  document.getElementById('newPostBtn').style.display = (friend.name === loggedIn.name) ? 'inline-flex' : 'none';

  // render posts
  renderPostsGrid(friend.name);
}

/* ---------- Render posts grid for a user ---------- */
function renderPostsGrid(username){
  postsGrid.innerHTML = '';
  const posts = loadPosts(username).sort((a,b)=>b.createdAt - a.createdAt);
  if(posts.length === 0){ noPostsNotice.textContent = 'No posts yet â€” be the first to add one!'; } else { noPostsNotice.textContent = ''; }
  if(posts.length === 0) { postsGrid.innerHTML = ''; return; }
  posts.forEach(post=>{
    const p = document.createElement('div'); p.className='post';
    const img = document.createElement('img'); img.className='post-img'; img.src = post.image;
    const body = document.createElement('div'); body.className='post-body';
    const cap = document.createElement('div'); cap.className='caption'; cap.textContent = post.caption || '';
    const meta = document.createElement('div'); meta.className='post-meta';
    const left = document.createElement('div'); left.innerHTML = `<div class="small-muted">${fmtDate(post.createdAt)}</div>`;
    const right = document.createElement('div');
    // delete button only if logged in user === username
    if(loggedIn.name === username){
      const del = document.createElement('button'); del.className='icon-btn'; del.title='Delete post'; del.innerHTML = 'ðŸ—‘ï¸';
      del.onclick = ()=>{ if(confirm('Delete this post?')){ deletePost(username, post.id); } };
      right.appendChild(del);
    }
    // placeholder heart button (future)
    const heart = document.createElement('button'); heart.className='icon-btn'; heart.title='Heart (coming)'; heart.innerHTML='ðŸ¤';
    heart.onclick = ()=>{ alert('Heart/like feature will be added later â€” you can wire it up!'); };
    right.appendChild(heart);

    meta.appendChild(left); meta.appendChild(right);
    body.appendChild(cap); body.appendChild(meta);
    p.appendChild(img); p.appendChild(body);
    postsGrid.appendChild(p);
  });
}

/* ---------- Delete post ---------- */
function deletePost(username, postId){
  const posts = loadPosts(username).filter(p=>p.id !== postId);
  savePosts(username, posts);
  // if viewing same profile, re-render
  if(currentView === username) renderPostsGrid(username);
}

/* ---------- New Post modal ---------- */
document.getElementById('newPostBtn').addEventListener('click', ()=>{ openNewPostModal(); });

function openNewPostModal(){
  if(!loggedIn) return alert('Please login first');
  const modal = document.createElement('div'); modal.className='modal-backdrop';
  modal.innerHTML = `
    <div class="modal" role="dialog">
      <h3 style="margin:0 0 8px">New Post</h3>
      <div class="form-row"><input id="postImageInput" class="input" type="file" accept="image/*"></div>
      <div class="form-row"><textarea id="postCaptionInput" class="input" placeholder="Write a caption..."></textarea></div>
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button id="cancelPost" class="btn btn-ghost">Cancel</button>
        <button id="savePost" class="btn btn-primary">Post</button>
      </div>
    </div>
  `;
  modalRoot.appendChild(modal);
  modal.querySelector('#cancelPost').onclick = ()=> modal.remove();
  modal.querySelector('#savePost').onclick = async ()=>{
    const fileInput = modal.querySelector('#postImageInput');
    const caption = modal.querySelector('#postCaptionInput').value.trim();
    const file = fileInput.files[0];
    if(!file){ alert('Please choose an image'); return; }
    // convert to dataURL
    const dataURL = await readFileAsDataURLAsync(file);
    const posts = loadPosts(loggedIn.name);
    const newPost = { id: 'p_' + Date.now(), image: dataURL, caption, createdAt: Date.now() };
    posts.push(newPost);
    savePosts(loggedIn.name, posts);
    modal.remove();
    if(currentView === loggedIn.name) renderPostsGrid(loggedIn.name);
  };
}

/* ---------- Edit profile (bio & avatar) ---------- */
document.getElementById('editProfileBtn').addEventListener('click', ()=>{
  const name = loggedIn.name;
  const profile = loadProfile(name) || {};
  const modal = document.createElement('div'); modal.className='modal-backdrop';
  modal.innerHTML = `
    <div class="modal">
      <h3 style="margin:0 0 8px">Edit Profile</h3>
      <div class="form-row"><label class="small">Bio</label><textarea id="bioInput" class="input">${profile.bio || loggedIn.bio || ''}</textarea></div>
      <div class="form-row"><label class="small">Avatar image (optional)</label><input id="avatarFile" type="file" accept="image/*" class="input"></div>
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button id="cancelEdit" class="btn btn-ghost">Cancel</button>
        <button id="saveEdit" class="btn btn-primary">Save</button>
      </div>
    </div>
  `;
  modalRoot.appendChild(modal);
  modal.querySelector('#cancelEdit').onclick = ()=> modal.remove();
  modal.querySelector('#saveEdit').onclick = async ()=>{
    const newBio = modal.querySelector('#bioInput').value.trim();
    const file = modal.querySelector('#avatarFile').files[0];
    if(file){
      const dataURL = await readFileAsDataURLAsync(file);
      saveAvatar(name, dataURL);
      // update side avatar and profile avatar
      const side = document.getElementById('avatar_side_' + name);
      if(side){ side.style.backgroundImage = `url(${dataURL})`; side.textContent=''; side.style.backgroundSize='cover'; }
      profileAvatarEl.style.backgroundImage = `url(${dataURL})`; profileAvatarEl.textContent=''; profileAvatarEl.style.backgroundSize='cover';
    }
    saveProfile(name, { bio:newBio });
    profileBioEl.textContent = newBio;
    renderFriendsList();
    modal.remove();
  };
});

/* ---------- utilities ---------- */
function readFileAsDataURLAsync(file){
  return new Promise((res, rej)=>{
    const fr = new FileReader();
    fr.onload = ()=>res(fr.result);
    fr.onerror = rej;
    fr.readAsDataURL(file);
  });
}

/* ---------- start of app: check if already logged in (optional) ---------- */
// We do simple flow for now: no persistent session. Show login screen initially.


// dark toggle
document.getElementById('darkToggle').addEventListener('click', ()=>{
  document.documentElement.classList.toggle('dark');
  document.body.classList.toggle('dark');
});

// Logout button (global)
document.getElementById('logoutBtn').addEventListener('click', ()=>{
  if(confirm('Logout?')){ loggedIn=null; currentView=null; appRoot.style.display='none'; loginScreen.style.display='block'; document.getElementById('loginName').value=''; document.getElementById('loginPassword').value=''; document.getElementById('authArea').innerHTML=''; }
});

/* ---------- initial rendering when logged in will call these functions ---------- */
</script>
</body>
</html>
